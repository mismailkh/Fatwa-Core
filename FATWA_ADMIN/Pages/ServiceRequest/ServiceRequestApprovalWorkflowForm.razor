@using FATWA_DOMAIN.Models.ViewModel.ServiceRequestVMs
@layout MainLayout
<RadzenTemplateForm Submit="@Form0Submit" Data="@serviceRequestApprovalVm" TItem="ServiceRequestFinalApprovalVM">
    <ChildContent>
        <div class="col-md-12">
            <div class="row">
                <div class="col-6">
                    <div class="form-group">
                        <RadzenLabel Style="font-weight:bold" Text="@(translationState.Translate("Service_Request") + "*")" Component="ServiceRequest" />
                        <RadzenDropDown Data="@ServiceRequestTypes"
                                           SelectAllText="@translationState.Translate("Selected_All")"
                                SelectedItemsText="@translationState.Translate("Items_Ielected")"
                                Multiple="true"
                                        AllowClear="true"
                                        Name="ServiceRequest"
                                        ValueProperty="Id"
                                        AllowFiltering="true"
                                        Placeholder="@translationState.Translate("Select")"
                                        Style="width:100%;max-width:100%;"
                        @bind-Value="@serviceRequestApprovalVm.ServiceRequestTypesId"
                                        TextProperty="@(Thread.CurrentThread.CurrentUICulture.Name == "en-US" ? "NameEn" : "NameAr" )" />
                        <RadzenRequiredValidator Component="ServiceRequest" Text="@translationState.Translate("Required_Field")" />
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <RadzenLabel Style="font-weight:bold" Text="@(translationState.Translate("Department") + "*")" Component="department" />
                        <RadzenDropDown Data="@Departments"
                                        AllowFiltering="true"
                                        AllowClear="true"
                                        TextProperty="@(Thread.CurrentThread.CurrentUICulture.Name == "en-US" ? "Name_En" : "Name_Ar" )"
                                        ValueProperty="Id"
                                        Placeholder="@translationState.Translate("Select")"
                                        Style="width:100%;max-width:100%;"
                                        Change="@(GetOperatingSectorsByDepartmentId)"
                        @bind-Value="@serviceRequestApprovalVm.DepartmentId"
                                        Name="department" />
                        <RadzenRequiredValidator DefaultValue="0" Component="department" Text="@translationState.Translate("Required_Field")" />
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <RadzenLabel Style="font-weight:bold" Text="@(translationState.Translate("Sector") + "*")" Component="sector" />
                        <RadzenDropDown Data="@OperatingSectors"
                                        AllowFiltering="true"
                                        SelectAllText="@translationState.Translate("Selected_All")"
                                        SelectedItemsText="@translationState.Translate("Items_Ielected")"
                                        Multiple="true"
                                        AllowClear="true"
                                        TextProperty="@(Thread.CurrentThread.CurrentUICulture.Name == "en-US" ? "Name_En" : "Name_Ar" )"
                                        ValueProperty="Id"
                                        Placeholder="@translationState.Translate("Select")"
                                        Style="width:100%;max-width:100%;"
                        @bind-Value="@serviceRequestApprovalVm.SectorIds"
                                        Change="@(GetRolesBySectorTypeId)"
                                        Name="sector" />
                        <RadzenRequiredValidator DefaultValue="0" Component="sector" Text="@translationState.Translate("Required_Field")" />
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <RadzenLabel Style="font-weight:bold" Text="@(translationState.Translate("Level_Of_Approval") + "*")" Component="levels" />
                        <RadzenNumeric TValue="int" Min="0" Max="5" Change="@(OnNumberOfApprovalChange)" @bind-Value="serviceRequestApprovalVm.NoOfApproval" Name="levels" Style="width:100%;max-width:100%;" />
                        <RadzenRequiredValidator Component="levels" Text="@translationState.Translate("Required_Field")" />
                    </div>
                </div>

                @if (refreshApprovals)
                {
                    @for (int i = 1; i <= serviceRequestApprovalVm.NoOfApproval; i++)
                    {
                        <div class="col-6">
                            <div class="form-group">
                                <RadzenLabel Style="font-weight:bold" Text="@(i +" "+ translationState.Translate("Approval"))" Component="role" />
                                <RadzenDropDown Data="@Roles"
                                                TValue="Guid"
                                                AllowFiltering="true"
                                                AllowClear="true"
                                                TextProperty="@(Thread.CurrentThread.CurrentUICulture.Name == "en-US" ? "SectorAndRoleNameEn" : "SectorAndRoleNameAr" )"
                                                ValueProperty="Id"
                                                Placeholder="@translationState.Translate("Select")"
                                                Style="width:100%;max-width:100%;"
                                                Name="role"
                                                ValueChanged=@( (Guid id) => OnSectorAndRoleSelection(id , i) ) />
                                <RadzenRequiredValidator DefaultValue="0" Component="role" Text="@translationState.Translate("Required_Field")" />
                            </div>
                        </div>
                    }
                }

            </div>
            <div class="row">
                <div class="col-12 p-3" style="text-align:end;">
                    <RadzenButton ButtonType="Radzen.ButtonType.Submit"
                                  style="margin-left: 0.2rem !important"
                                  ButtonStyle="ButtonStyle.Primary"
                                  Text="@(Id > 0  ? translationState.Translate("Update") : translationState.Translate("Add"))" />
                    <RadzenButton ButtonStyle="ButtonStyle.Light"
                                  Text="@translationState.Translate("Cancel")"
                                  Click="@CancelForm" />
                </div>
            </div>
        </div>
    </ChildContent>
</RadzenTemplateForm>

